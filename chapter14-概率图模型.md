## Chapter14 概率图模型

### 隐马尔可夫模型

概率模型提供了一种描述框架，将学习任务归结于计算变量的概率分布。

在概率模型中，利用已知变量推测未知变量的分布称为**推断**

**概率图模型：**是一类用图来表达变量相关关系的概率模型。大致可分为两类：

* 使用有向无环图表示变量间的依赖关系，称为有向图模型或贝叶斯网
* 使用无向图表示变量间的相关关系，称为无向图模型或马尔可夫网

**隐马尔可夫模型：**是结构最简单的动态贝叶斯网，这是一种著名的有向图模型，主要用于时序建模，在语音识别、自然语言处理等领域有广泛应用。

<img src=".assets/image-20231201154838818.png" alt="image-20231201154838818" style="zoom:50%;" />

模型中的变量分为两组：

* 第一组是状态变量$\{y_1,y_2,...,y_n\}$，其中$y_i\in \mathcal{Y}$表示第i时刻的系统状态，通常假设状态变量是隐藏的、不可被观测的，亦称隐变量
* 第二组是观测变量$\{x_1,x_2,...,x_n\}$，其中$x_i\in \mathcal{X}$表示第i时刻的观测值

**马尔科夫链：**系统下一时刻的状态仅有当前状态决定，不依赖于以往的任何状态

基于这种依赖关系，所有变量的联合概率分布为：
$$
P(x_1,y_1,...,x_n,y_n)=P(y_1)P(x_1|y_1)\prod_{i=2}^nP(y_i|y_{i-1})P(x_i|y_i)
$$
除了结构信息，要确定一个隐马尔可夫模型还需要以下三组参数：

* 状态转移概率：模型在各个状态间转换的概率，通常记为矩阵$A=[a_{ij}]_{N\times N}$，其中
  $$
  a_{ij}=P(y_{t+1}=s_j|y_t=s_i)
  $$

* 输出观测概率：模型根据当前状态获得各个观测值的概率，通常记为矩阵$B=[b_{ij}]_{N\times N}$，其中
  $$
  b_{ij}=P(x_t=o_j|y_t=s_i)
  $$

* 初始状态概率，模型在初始时刻各状态出现的概率，通常记为$\pi=(\pi_1,\pi_2,...,\pi_N)$，其中
  $$
  \pi_i=P(y_1=s_i)\ \ \ \ 1 \le i \le N
  $$

在实际应用中，常关注隐马尔可夫模型的三个基本问题：

* 如何评估模型与观测序列之间的匹配程度
* 如何根据观测序列推断出隐藏的模型状态
* 如何训练模型使其能最好地描述观测数据

### 马尔可夫随机场

> 一种著名的无向图模型，图中每个节点表示一个或一组变量，节点之间的边表示两个变量之间的依赖关系

**团**：对于图中的一个自己，若其中任意两节点都有边连接，则称该节点子集为一个团

**极大团：**若在一个团中加入另外任何一个节点都不再形成团，则称该团为极大团

在马尔可夫随机场中，多个变量之间的联合概率分布能基于团分解为多个因子的乘积，每个因子仅与一个团相关，具体来说，对于n个变量$\mathbf{x}=\{x_1,x_2,...,x_n\}$，所有团构成的集合为$\mathcal{C}$，与团$Q\in \mathcal{C}$对应的变量集合记为$\mathbf{x}_Q$，则联合概率$P(\mathbf{x})$定义为：
$$
P(\mathbf{x})=\cfrac{1}{Z}\prod_{Q\in \mathcal{C}}\psi_Q(\mathbf{x}_Q)\\
其中，\psi_Q为与团Q对应的势函数，用于对团Q中的变量关系进行建模\\
Z=\sum_{\mathbf{x}}\prod_{Q\in \mathcal{C}}\psi_Q(\mathbf{x}_Q)为规范化因子，以确保P(\mathbf{x})是被正确定义的概率
$$
联合概率$P(\mathbf{x})$可基于极大团来定义，假定所有极大团构成的集合为$\mathcal{C}^*$，则有：
$$
P(\mathbf{x})=\cfrac{1}{Z^*}\prod_{Q\in \mathcal{C}^*}\psi_Q(\mathbf{x}_Q)
$$


<img src=".assets/image-20231201163318174.png" alt="image-20231201163318174" style="zoom:50%;" />

如图，若从结点集A中的结点到B中的结点都必须经过结点集C中的结点，则称结点集A和B被结点集C分离，C称为**分离集**，对马尔科夫随机场，有：

* 全局马尔可夫性：给定两个变量子集的分离集，则这两个变量子集条件独立

势函数是非负函数，因此指数函数常被用于定义势函数：
$$
\psi_Q(\mathbf{x}_Q)=e^{-H_Q(\mathbf{x}_Q)}
$$

### 条件随机场

> 是一种判别式无向图模型，对条件分布进行建模。条件随机场试图对多个变量在给定观测值后的条件概率进行建模。隐马尔可夫模型和马尔可夫随机场都是生成式模型，而条件随机场是判别式模型。

![image-20231206094113412](.assets/image-20231206094113412.png)

令$G<V,E>$表示结点与标记变量$\mathbf{y}$中元素一一对应的无向图，$y_v$表示与结点v对应的标记变量，$n(v)$表示结点v的邻接结点，若图G的每个变量$y_v$都满足马尔可夫性，即：
$$
P(y_v|\mathbf{x,y_{V\backslash \{v\}}})=P(y_v|\mathbf{x,y_{n(v)}})
$$
则$(\mathbf{y,x})$构成一个条件随机场

对于标记序列模型来说，最常用的仍然是下图所示的链式结构，即链式条件随机场：
![image-20231206095350238](.assets/image-20231206095350238.png)

### 学习与推断

> 对概率图模型，需要确定具体分布的参数，这称为参数估计或参数学习问题，通常使用极大似然估计或最大后验概率估计求解，但若将参数视为待推测的变量，则参数估计过程和推断十分类似，可以吸收到推断问题

概率图模型的推断方法大致可分为两类：

* 精确推断法，希望能计算出目标变量的边际分布或条件分布的精确值，但是此类方法随着极大团规模的增长呈指数增长
* 近似推断法，希望在较低的时间复杂度下获得原问题的近似解

#### 变量消去

> 精确推断的实质是一类动态规划算法，它利用图模型所描述的条件独立性来削减计算目标概率值所需的计算量，变量消去法是最直观的精确推断算法

![image-20231206104812367](.assets/image-20231206104812367.png)

#### 信念传播

> 信念传播算法将变量消去法中的求和操作看作一个消息传递过程，较好地解决了求解多个边际分布时的重复计算问题

![image-20231206104840535](.assets/image-20231206104840535.png)

### 近似推断

近似推断方法大致可以分为两大类:

* 采样：通过使用随机化方法完成近似
* 使用确定性近似完成近似推断，典型代表为变分推断

#### MCMC采样

> 概率图模型中最常采用的采样技术时马尔科夫链蒙特卡罗MCMC方法

#### 变分推断

> 变分推断通过使用已知简单分布来逼近需推断的复杂分布，并通过限制近似分布的类型，从而得到一种局部最优、但具有确定解的近似后验分布

### 话题模型

> 话题模型时一族生成式有向图模型，主要用于处理离散型数据（如：文本集合），在信息检索、自然语言处理等领域由广泛应用，隐狄利克雷分配模型（LDA）是话题模型的典型代表。

话题模型中的几个概念：

* 词：待处理数据的基本离散单元
* 文档：待处理的数据对象
* 话题：表示一个概念，具体表示为一系列相关的词，以及它们在该概念下出现的概率

![image-20231206111742127](.assets/image-20231206111742127.png)
